(function(b,a){if(a.scrupload){return}var c=a.scrupload=a.scrupload||{};c.SELECTED=1;c.UPLOADING=2;c.FAILED=3;c.DONE=4;c.ERROR_TYPE=10;c.ERROR_SIZE_LIMIT=11;c.ERROR_QUEUE_LIMIT=12;c.uniqid=function(){var g="abcdefghijklmnopqrstuvwxyz",e=[],d=g.length;for(var f=0;f<8;++f){e.push(g.charAt(Math.floor(d*Math.random())))}return e.join("")+new Date().getTime()};c.buildUrlQuery=function(d,f){var e=b.param(f);return e.indexOf("?")!=-1?d+"&"+e:d+"?"+e};c.generateElementId=function(d){var e=d.attr("id");if(e){return e}while(true){e=this.uniqid();if(b("#"+e).length===0){d.attr("id",e);return e}}};c.buildDefaultPostParams=function(d){if(d.types){d.post_params.types=d.types}if(d.size_limit){d.post_params.size_limit=d.size_limit}};c.checkTypes=function(f,d){var g=f.split("|");for(var e=0;e<g.length;e++){if(d.toLowerCase().lastIndexOf(g[e].toLowerCase())==d.length-g[e].length){return true}}return false};c.defaultOptions=function(d){return b.extend({},{file_post_name:"file",post_params:{},get_params:{}},d||{})};c.initButtonEvent=function(f,e){var d=false;e.mouseout(function(){if(d){f._trigger("onButtonOut",null,{element:f.element,runtime:f.runtime,options:f.options});d=false}}).mouseover(function(){if(!d){f._trigger("onButtonOver",null,{element:f.element,runtime:f.runtime,options:f.options});d=true}}).mousedown(function(){f._trigger("onButtonDown",null,{element:f.element,runtime:f.runtime,options:f.options})})};c.createFile=function(d,e){return{id:this.uniqid(),time:new Date(),filename:d,status:this.SELECTED,user:{},get:b.extend({},e.get_params),post:b.extend({},e.post_params)}};b.widget("ui.scruploadHtml4",{options:scrupload.defaultOptions({}),_create:function(){var d=this;d.queue_array=[];scrupload.buildDefaultPostParams(d.options);d._initInterface();d.runtime={name:"html4",object:d.input};d._trigger("onInit",null,{element:d.element,runtime:d.runtime,options:d.options})},_initInterface:function(){vard=this;d._createFormAndInput()},_createFormAndInput:function(){var d=this;d.input=b('<input type="file" name="'+d.options.file_post_name+'" />');d.container=b("<span />");d.input.appendTo(d.container.appendTo(d.element));scrupload.initButtonEvent(d,d.container);d.input.change(function(){var h=b('<form action="'+d.options.url+'" method="post" enctype="multipart/form-data" />'),f="n/a",e,g;h.appendTo(document.body).append(b(this));if(this.value){f=this.value;e=f.match(/[\/\\]([^\/\\]+)$/i);if(e){f=e[1]}}g=scrupload.createFile(f,d.options);if(d.options.types&&f!="n/a"){if(!scrupload.checkTypes(d.options.types,f)){g.status=scrupload.FAILED;d._trigger("onError",null,{element:d.element,file:g,error:scrupload.ERROR_TYPE,runtime:d.runtime,options:d.options});d._resetInterface();return}}if(d.options.queue_limit&&d.queue_array.length==d.options.queue_limit){g.status=scrupload.FAILED;d._trigger("onError",null,{element:d.element,file:g,error:scrupload.ERROR_QUEUE_LIMIT,runtime:d.runtime,options:d.options});d._resetInterface();return}d.queue_array.push(g);d._trigger("onSelect",null,{element:d.element,runtime:d.runtime,file:g,options:d.options});h.submit(function(){g.post.id=g.id;b.each(g.post,function(j){h.append('<input type="hidden" name="'+j+'" value="'+this+'" />')});var i=h.attr("action");i=scrupload.buildUrlQuery(i,g.get);h.attr("action",i);g.status=scrupload.UPLOADING;d._trigger("onProgress",null,{element:d.element,runtime:d.runtime,file:g,progress:{percent:0},options:d.options})});h.attr("target",g.id);h.find("input[name=id]").val(g.id);b('<iframe src="about:blank" name="'+g.id+'">').appendTo(document.body).css({width:"1px",height:"1px",position:"absolute",left:"-10000px",top:"-10000px"}).load(function(){var i=b(this),j=b(this.contentWindow.document.body).text();if(j){d._trigger("onProgress",null,{element:d.element,file:g,runtime:d.runtime,progress:{percent:100},options:d.options});g.status=scrupload.DONE;d._trigger("onFileComplete",null,{element:d.element,file:g,runtime:d.runtime,response:j,options:d.options});d._trigger("onComplete",null,{element:d.element,uploaded:[g],runtime:d.runtime,files:d.queue_array,options:d.options})}setTimeout(function(){i.remove();h.remove();d._resetInterface()},0)});h.submit()})},_resetInterface:function(){this.container.remove();this._initInterface()},destroy:function(){this.container.remove();this.queue_array=[];this.input=undefined;b.Widget.prototype.destroy.apply(this,arguments);return this}});b.widget("ui.scruploadSwfupload",{options:scrupload.defaultOptions({swfupload:{prevent_swf_caching:false,button_cursor:SWFUpload.CURSOR.HAND},mutiple_select:true}),_create:function(){var d=this;d.queue_array=[];scrupload.buildDefaultPostParams(d.options);d._initInterface()},_initInterface:function(){var e=this,g={},d=[],f;e.swf_container=b("<div><div></div></div>").appendTo(e.element);e.swf_container.width(e.options.swfupload.button_width);e.swf_container.height(e.options.swfupload.button_height);e.swfuploader=null;f=b.extend(e.options.swfupload,{file_post_name:e.options.file_post_name,upload_url:e.options.url,file_size_limit:e.options.size_limit,button_placeholder_id:scrupload.generateElementId(e.swf_container.find("div")),preserve_relative_urls:true,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,swfupload_loaded_handler:function(){e.runtime={name:"swfupload",object:e.swfuploader};e._trigger("onInit",null,{element:e.element,runtime:e.runtime,options:e.options})},file_queued_handler:function(i){var h=scrupload.createFile(i.name,e.options);if(e.options.queue_limit&&e.queue_array.length==e.options.queue_limit){h.status=scrupload.FAILED;e._trigger("onError",null,{element:e.element,file:h,error:scrupload.ERROR_QUEUE_LIMIT,runtime:e.runtime,options:e.options});this.cancelUpload(i.id)}else{e.queue_array.push(h);d.push(h);g[i.id]=h;e._trigger("onSelect",null,{element:e.element,runtime:e.runtime,file:h,options:e.options})}},file_dialog_complete_handler:function(h,i){this.startUpload()},upload_start_handler:function(j){var i=g[j.id],h;i.post.id=i.id;this.setPostParams(i.post);h=scrupload.buildUrlQuery(e.options.url,i.get);this.setUploadURL(h)},upload_progress_handler:function(l,i,k){var h=g[l.id],j=Math.ceil((i/k)*100);h.status=scrupload.UPLOADING;e._trigger("onProgress",null,{element:e.element,runtime:e.runtime,file:h,progress:{percent:j,bytes_loaded:i,bytes_total:k,options:e.options}})},upload_success_handler:function(i,j){var h=g[i.id];h.status=scrupload.DONE;e._trigger("onFileComplete",null,{element:e.element,runtime:e.runtime,file:h,response:j,options:e.options})},queue_complete_handler:function(h){e._trigger("onComplete",null,{element:e.element,runtime:e.runtime,uploaded:d,files:e.queue_array,options:e.options});d=[];g={}}});if(!e.options.mutiple_select){f.button_action=SWFUpload.BUTTON_ACTION.SELECT_FILE}scrupload.initButtonEvent(e,e.swf_container);e.swfuploader=new SWFUpload(f)},getRuntime:function(){return this.swfuploader},destroy:function(){this.swfuploader.destroy();this.swf_container.remove();this.queue_array=[];b.Widget.prototype.destroy.apply(this,arguments);return this}});b.widget("ui.scrupload",{options:{runtimes:"swfupload|html4"},_create:function(){var e=this,d={swfupload:e.detectFlashVer(8,0,0)&&window.SWFUpload,html4:true},g=e.options.runtimes.split("|"),h;g.push("html4");for(var f=0;f<g.length;f++){if(d[g[f]]){h="scrupload"+g[f].substr(0,1).toUpperCase()+g[f].substr(1);e.element[h](e.options);break}}},detectFlashVer:function(j,g,f){self.isIE=(navigator.appVersion.indexOf("MSIE")!=-1)?true:false;self.isWin=(navigator.appVersion.toLowerCase().indexOf("win")!=-1)?true:false;self.isOpera=(navigator.userAgent.indexOf("Opera")!=-1)?true:false;var h=this._getFlashVesion(),i,d,e;if(h==-1){return false}else{if(h!=0){if(self.isIE&&self.isWin&&!self.isOpera){tempArray=h.split(" ");tempString=tempArray[1];versionArray=tempString.split(",")}else{versionArray=h.split(".")}i=versionArray[0];d=versionArray[1];e=versionArray[2];if(i>parseFloat(j)){return true}else{if(i==parseFloat(j)){if(d>parseFloat(g)){return true}else{if(d==parseFloat(g)){if(e>=parseFloat(f)){return true}}}}}return false}}},_getFlashVesion:function(){var j=-1,i,d,h,f,k,e,g;if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){i=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"";d=navigator.plugins["Shockwave Flash"+i].description;h=d.split(" ");f=h[2].split(".");k=f[0];e=f[1];g=h[3];if(g==""){g=h[4]}if(g[0]=="d"){g=g.substring(1)}else{if(g[0]=="r"){g=g.substring(1);if(g.indexOf("d")>0){g=g.substring(0,g.indexOf("d"))}}}j=k+"."+e+"."+g}}else{if(navigator.userAgent.toLowerCase().indexOf("webtv/2.6")!=-1){j=4}else{if(navigator.userAgent.toLowerCase().indexOf("webtv/2.5")!=-1){j=3}else{if(navigator.userAgent.toLowerCase().indexOf("webtv")!=-1){j=2}else{if(self.isIE&&self.isWin&&!self.isOpera){j=this._getFlashVersionForIE()}}}}}return j},_getFlashVersionForIE:function(){var d,f,g;try{f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");d=f.GetVariable("$version")}catch(g){}if(!d){try{f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");d="WIN 6,0,21,0";f.AllowScriptAccess="always";d=f.GetVariable("$version")}catch(g){}}if(!d){try{f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");d=f.GetVariable("$version")}catch(g){}}if(!d){try{f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");d="WIN 3,0,18,0"}catch(g){}}if(!d){try{f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");d="WIN 2,0,0,11"}catch(g){d=-1}}return d},destroy:function(){this.container.remove();this.queue_array=[];this.button=undefined;b.Widget.prototype.destroy.apply(this,arguments);return this}})})(jQuery,(function(){return this})());